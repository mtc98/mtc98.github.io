# 五指棋遊戲

一個經典的五指棋（五子棋）人機對戰遊戲，使用純HTML5、CSS3和JavaScript開發。

## 遊戲特色

- 🎮 人機對戰，五指棋經典規則
- 🤖 智慧AI對手，具有多種難度等級
- 🎵 內建音效系統（可開關）
- 📱 響應式設計，支援桌面和移動設備
- ⌨️ 鍵盤快捷鍵支援
- 🎨 美觀的現代化界面設計

## 遊戲規則

1. 棋盤為15×15格
2. 玩家使用黑棋，電腦使用白棋
3. 玩家先下，輪流落子
4. 率先連成五顆同色棋子（橫、直、斜）者獲勝
5. 如果棋盤滿了仍無勝者，則為平局

## 如何遊玩

### 線上遊玩
1. 開啟 `index.html` 檔案
2. 點擊棋盤上的任意空位下棋
3. 電腦會自動回應
4. 繼續遊戲直到有人獲勝

### 測試模式
開啟 `test.html` 檔案進行測試和除錯。

## 檔案結構

```
games/5chess/
├── index.html          # 主遊戲頁面
├── test.html           # 測試頁面
├── css/
│   └── game.css        # 遊戲樣式
├── js/
│   ├── Board.js        # 棋盤管理
│   ├── Game.js         # 遊戲邏輯
│   ├── AI.js           # AI對手邏輯
│   └── main.js         # 主程式
├── sounds/
│   ├── place.mp3       # 落子音效
│   └── win.mp3         # 勝利音效
└── README.md           # 說明文件
```

## 鍵盤快捷鍵

- **Ctrl + R**: 重新開始遊戲
- **Ctrl + Z**: 悔棋（可悔兩步）
- **Ctrl + S**: 切換音效開關

## 技術特色

### AI演算法
- 使用極大極小演算法（Minimax）搭配Alpha-Beta剪枝
- **智能搜索優化**：只搜索已有棋子附近2格內的位置，大幅提升運算速度
- **動態搜索深度**：根據候選位置數量動態調整（深度2-3）
- **戰術優先級系統**（按優先級排序）：
  1. 立即獲勝（五連）
  2. 阻擋對手獲勝（活四必勝）
  3. 形成活四（必勝棋型）
  4. 阻擋對手活四
  5. 形成活三（進攻棋型）
  6. 阻擋對手活三
  7. 極大極小演算法搜索最佳位置
- 智慧評估函數，考慮棋盤位置價值和連線威脅

### 棋型定義
- **活四**：四顆連續棋子，兩端都是空位（_XXXX_），下一步必勝
- **活三**：三顆連續棋子，兩端都是空位且至少一端可延伸（_XXX_），可形成活四
- **死四**：四顆連續棋子，但只有一端是空位（XXXX_或邊界），可被阻擋

### 響應式設計
- CSS Grid和Flexbox布局
- 支援各種螢幕尺寸
- 觸控友善的移動端體驗

### 音效系統
- **Web Audio API** 程式化音效生成（無需外部音效檔案）
- 落子音效：800Hz → 400Hz 下降音調（0.1秒）
- 勝利音效：C-E-G-C 上升音階（C大調和弦）
- 可切換的音效開關（右上角按鈕或 Ctrl+S）
- 自動恢復機制處理瀏覽器音效暫停
- 即時狀態提示（音效已開啟/關閉）

## 開發者資訊

### 主要類別
- `Board`: 棋盤狀態管理和渲染
- `Game`: 遊戲流程和狀態控制
- `AI`: 電腦玩家邏輯
- `AudioManager`: 音效管理系統

### 擴展功能
遊戲支援以下擴展：
- 自訂AI難度等級
- 遊戲統計追蹤
- 多種棋盤主題
- 線上多人對戰

## 相容性

- 現代瀏覽器（Chrome、Firefox、Safari、Edge）
- 支援HTML5的行動裝置
- 不需要額外外掛程式或框架

## 授權

此遊戲為開源專案，可自由使用和修改。

---

## 修正記錄

### 2025-10-01 重大更新

#### 1. 修正棋子顯示問題
- **問題**：點擊棋盤後棋子無法顯示
- **原因**：CSS 動畫的 `transform` 屬性覆蓋了棋子的居中定位
- **修正**：將 `@keyframes placePiece` 中的 `transform: scale()` 改為 `transform: translate(-50%, -50%) scale()`

#### 2. 音效系統重構
- **問題**：音效檔案為空（0 bytes），無法播放
- **修正**：改用 **Web Audio API** 程式化生成音效
  - 落子音效：使用 Oscillator 生成 800Hz → 400Hz 的下降音調
  - 勝利音效：播放 C-E-G-C 音階（C大調和弦）
  - 添加 `audioContext.resume()` 處理瀏覽器自動暫停
  - 增加音效狀態即時提示訊息

#### 3. AI 性能優化
- **問題**：電腦思考時卡住不反應
- **原因**：搜索空間過大（15×15=225個位置），深度4導致運算量爆炸
- **修正**：
  - **智能搜索範圍**：只搜索已有棋子附近2格內的位置
  - **動態搜索深度**：候選位置 >20 時用深度2，否則深度3
  - **限制搜索數量**：minimax 最多搜索15個候選位置
  - **開局優化**：第一步固定下天元，第二步下在附近隨機位置

#### 4. AI 戰術邏輯增強
- **新增功能**：七級優先級決策系統
  1. **立即獲勝**：檢測五連機會
  2. **阻擋必勝**：防禦對手的活四（兩端空位的四連）
  3. **形成活四**：創造必勝棋型（_XXXX_）
  4. **阻擋活四**：防止對手形成活四
  5. **形成活三**：創造進攻棋型（_XXX_），可發展為活四
  6. **阻擋活三**：防止對手形成活三
  7. **極大極小演算法**：深度搜索最佳位置

- **新增檢測函數**：
  - `findLivelyFourMove()` - 檢測活四棋型
  - `checkLivelyFour()` - 驗證四連兩端是否為空
  - `findLivelyThreeMove()` - 檢測活三棋型
  - `checkLivelyThree()` - 驗證三連是否可發展為活四
  - `countInDirection()` - 單向連續棋子計數
  - `isEmptyAt()` - 安全的空位檢測

#### 5. 調試增強
- 添加詳細的 console.log 追蹤 AI 決策過程
- 顯示有效移動數量、候選移動數量
- 輸出 AI 選擇的戰術類型（活四/活三/最佳位置）

### 技術改進總結
- ✅ 棋子正常顯示動畫
- ✅ 音效完全正常播放
- ✅ AI 響應速度大幅提升（從卡死到即時響應）
- ✅ AI 戰術理解能力增強（理解活三、活四威脅）
- ✅ 更好的防守策略（優先阻擋活四>活三）